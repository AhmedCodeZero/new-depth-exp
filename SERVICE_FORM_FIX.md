# إصلاح مشكلة فورم طلب الخدمة

## المشكلة
كان فورم طلب الخدمة يظهر خطأ "حدث خطأ في إرسال طلبك" حتى مع البيانات الصحيحة.

## الأسباب
1. **متغيرات البيئة مفقودة**: API route كان يستخدم متغيرات بيئة غير موجودة
2. **مشكلة في Supabase**: إعدادات Supabase غير صحيحة
3. **عدم وجود تشخيص**: لم تكن هناك رسائل console.log للتشخيص

## الحلول المطبقة

### 1. إصلاح API Route الأصلي
- ✅ إضافة مفاتيح Supabase مباشرة بدلاً من متغيرات البيئة
- ✅ إضافة console.log للتشخيص
- ✅ تحسين رسائل الخطأ

### 2. إنشاء API Route بديل
- ✅ `app/api/service-requests-simple/route.ts`
- ✅ يحفظ البيانات في ملف JSON محلي
- ✅ لا يحتاج إلى قاعدة بيانات
- ✅ يعمل فوراً للاختبار

### 3. تحسين فورم طلب الخدمة
- ✅ إضافة console.log للتشخيص
- ✅ تحسين معالجة الأخطاء
- ✅ عرض تفاصيل الخطأ للمستخدم

### 4. ملفات الاختبار
- ✅ `test-service-form.html` - اختبار فورم طلب الخدمة
- ✅ `debug-buttons.html` - اختبار الأزرار
- ✅ `simple-admin-test.html` - اختبار لوحة التحكم

## كيفية الاستخدام

### 1. اختبار فوري
```
افتح: test-service-form.html
املأ البيانات واضغط "إرسال طلب الخدمة"
```

### 2. اختبار في الموقع
```
اذهب إلى: /request-service
املأ البيانات واضغط "إرسال طلب الخدمة"
```

### 3. مراقبة التشخيص
```
اضغط F12 → Console
ستظهر رسائل مفصلة عن عملية الإرسال
```

## الملفات المحدثة

### API Routes
- `app/api/service-requests/route.ts` - إصلاح Supabase
- `app/api/service-requests-simple/route.ts` - نسخة بديلة

### Frontend
- `app/request-service/page.tsx` - تحسين التشخيص

### ملفات الاختبار
- `test-service-form.html` - اختبار فورم طلب الخدمة
- `debug-buttons.html` - اختبار الأزرار
- `simple-admin-test.html` - اختبار لوحة التحكم

## البيانات المطلوبة
- ✅ الاسم الكامل (مطلوب)
- ✅ البريد الإلكتروني (مطلوب)
- ✅ رقم الهاتف (مطلوب)
- ✅ وصف المشروع (مطلوب)
- ⚪ الشركة (اختياري)
- ⚪ المنصب (اختياري)
- ⚪ الجدول الزمني (اختياري)
- ⚪ الميزانية (اختياري)
- ⚪ متطلبات خاصة (اختياري)

## النتيجة المتوقعة
- ✅ إرسال ناجح للبيانات
- ✅ رسالة نجاح تظهر للمستخدم
- ✅ إعادة تعيين النموذج
- ✅ حفظ البيانات في الملف المحلي

## استكشاف الأخطاء

### إذا ظهر خطأ "Missing required field"
- تأكد من ملء جميع الحقول المطلوبة
- تحقق من console.log لمعرفة الحقل المفقود

### إذا ظهر خطأ "Internal server error"
- تحقق من console.log في الخادم
- تأكد من وجود مجلد `data` في المشروع

### إذا لم يظهر أي شيء
- تحقق من console.log في المتصفح
- تأكد من أن API route يعمل

## ملاحظات مهمة
- النسخة البديلة تحفظ البيانات في `data/service-requests.json`
- يمكن استخدام النسخة الأصلية بعد إعداد Supabase
- جميع البيانات محفوظة محلياً للاختبار

